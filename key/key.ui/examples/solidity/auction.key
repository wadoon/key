\profile "Solidity";

\javaSource "auction/";


\programVariables {
  OneAuction self;
  Message msg;
}
 
\rules {
  
 insertCInv {
    \schemaVar \term Heap h;
    \schemaVar \term OneAuction self;
    \schemaVar \variable Address a;
    \find(CInv(h, self))
    \varcond(\notFreeIn(a, h, self))
    \replacewith(    
// line 40-41
       Address::select(h,
          OneAuction.AuctionInformation::select(h, self, OneAuction::$auction),
           OneAuction.AuctionInformation::$owner)!= self &
       Address::select(h, 
          OneAuction.BidInformation::select(h, self, OneAuction::$bid), 
             OneAuction.BidInformation::$bidder) != self &             
//line 52      
      int::select(h, 
          OneAuction.BidInformation::select(h, self, OneAuction::$bid),
                     OneAuction.BidInformation::$value) = 
      int::select(h, net, address(
            Address::select(h, 
               OneAuction.BidInformation::select(h, self, OneAuction::$bid), 
                 OneAuction.BidInformation::$bidder))) + 
      int::select(h, net, address(
        Address::select(h,
          OneAuction.AuctionInformation::select(h, self, OneAuction::$auction),
           OneAuction.AuctionInformation::$owner)
      ))                 
      &
// line 53-55:
 (\forall  a;(  
     (a != Address::select(h,
              OneAuction.AuctionInformation::select(h, self, OneAuction::$auction),
                          OneAuction.AuctionInformation::$owner) & 
      a != Address::select(h,
              OneAuction.BidInformation::select(h, self, OneAuction::$bid), 
                          OneAuction.BidInformation::$bidder) &
      a != self) -> int::select(h, net, address(a)) = 0) 
 ) &    
// line 56:  
    int::select(h, net, 
       address( Address::select(h,
          OneAuction.AuctionInformation::select(h, self, OneAuction::$auction),
           OneAuction.AuctionInformation::$owner))) <= 0   
& 
//line 57:
  (OneAuction.AuctionMode::select(h,null,OneAuction.AuctionMode::$Open) = 
     OneAuction.AuctionMode::select(h, 
         OneAuction.AuctionInformation::select(h, self, OneAuction::$auction),
              OneAuction.AuctionInformation::$mode) ->
      int::select(h, net, address(
         Address::select(h,
            OneAuction.AuctionInformation::select(h, self, OneAuction::$auction),
                       OneAuction.AuctionInformation::$owner))) = 0)  
&
// line 58:                       
  (int::select(h, net, 
       address(Address::select(h,
          OneAuction.AuctionInformation::select(h, self, OneAuction::$auction),
           OneAuction.AuctionInformation::$owner))) < 0                  
      ->
   int::select(h, 
          OneAuction.BidInformation::select(h, self, OneAuction::$bid),
                     OneAuction.BidInformation::$value) = 0   
   )        
 )
    \heuristics(userTaclets1)
  };

 }
 
\problem {
msg.sender != self         &
self.bid != null           &
self.bid.bidder != null    & 
self.auction != null       &
self.auction.owner != null &
msg.value >= 0 & CInv(heap, self) 
->
{savedHeap:=heap || heap:=store(heap, net, address(msg.sender), int::select(heap, net, address(msg.sender)) + msg.value)}
 \[{ 
    self.makeBid(msg)@OneAuction;
}\] CInv(heap, self)

}
