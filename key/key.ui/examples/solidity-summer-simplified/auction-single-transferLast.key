\profile "Solidity";

\javaSource "casino-transfer/";


\programVariables {
  OneAuction self;
  Message msg;
}
 
\rules {
  
 insertCInv {
    \schemaVar \term Heap h;
    \schemaVar \term OneAuction self;
    \schemaVar \variable Address a;
    \find(CInv(h, self))
    \varcond(\notFreeIn(a, h, self))
    \replacewith(    
// line 39-40
       Address::select(h, self, OneAuction::$owner) != self &
       Address::select(h, self, OneAuction::$bidder) != self &             
//line 51
      int::select(h, self, OneAuction::$value) = 
      int::select(h, net, address(
            Address::select(h, self, OneAuction::$bidder))) + 
      int::select(h, net, address(
        Address::select(h, self, OneAuction::$owner)
      ))                 
      &
// line 52-54:
 (\forall  a;(  
     (a != Address::select(h, self, OneAuction::$owner) & 
      a != Address::select(h, self, OneAuction::$bidder) &
      a != self) -> int::select(h, net, address(a)) = 0) 
 ) &    
// line 55:  
    int::select(h, net, 
       address( Address::select(h, self, OneAuction::$owner))) <= 0   
& 
//line 56:
  (OneAuction.AuctionMode::select(h,null,OneAuction.AuctionMode::$Open) = 
     OneAuction.AuctionMode::select(h, self, OneAuction::$mode) ->
      int::select(h, net, address(Address::select(h, self, OneAuction::$owner))) = 0)  
 )
    \heuristics(userTaclets1)
  };

 }
 
\problem {
msg.sender != self         &
self.bidder != null    & 
self.owner != null &
msg.value >= 0 & CInv(heap, self) 
->
{savedHeap:=heap || heap:=store(heap, net, address(msg.sender), int::select(heap, net, address(msg.sender)) + msg.value)}
 \[{ 
    self.makeBid(msg)@OneAuction;
}\] ( CInv(heap, self) 
 /*    &
      self.value >= self.value@savedHeap // cannot be shown, anonymization after transfer
      &
      int::select(heap, net, address(
         Address::select(heap, self, OneAuction::$bidder))) = msg.value
     &
      (self.bidder@savedHeap != msg.sender ->
       int::select(heap, net, address(
         Address::select(savedHeap, self, OneAuction::$bidder))) = 0)
 */        
)

}
