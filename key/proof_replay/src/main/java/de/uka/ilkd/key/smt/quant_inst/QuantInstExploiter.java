package de.uka.ilkd.key.smt.quant_inst;

import de.uka.ilkd.key.logic.Term;
import de.uka.ilkd.key.proof.Goal;
import de.uka.ilkd.key.rule.TacletApp;
import de.uka.ilkd.key.smt.*;

import java.util.HashSet;
import java.util.List;
import java.util.Set;

public class QuantInstExploiter extends SMTProofExploiter {
    Set<Term> instantiations = new HashSet<>();

    public QuantInstExploiter(SMTProblem problem) {
        super(problem);

        SMTSolver solver = problem.getSolvers().iterator().next();
        smtOutput = solver.getSolverOutput();
    }

    public void apply() {
        tree = parse(smtOutput);

        findProofStart();

        BindingsCollector bindingsCollector = new BindingsCollector(this);
        tree.accept(bindingsCollector);

        QuantInstExtractor extractor = new QuantInstExtractor(this, goal);
        proofStart.accept(extractor);

        for (Term inst : instantiations) {
            TacletApp cutApp = ReplayTools.createCutApp(goal, inst);
            List<Goal> goals = ReplayTools.applyInteractive(goal, cutApp).toList();
            goal = goals.get(1);
        }
    }

    public void addInstantiation(Term inst) {
        instantiations.add(inst);
    }
}
