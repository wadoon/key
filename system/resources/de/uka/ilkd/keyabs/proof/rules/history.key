\sorts {
  Future;
  HistoryLabel;
  ItfLabel;
  ClassLabel;
  MethodLabel;
  Unit;
  EventType;
}

\predicates {
    wfHist(Seq);
    containsEvent(HistoryLabel, Seq);
    containsFuture(Future, Seq);
    startsWith(Seq, Seq);
    endsWith(Seq, Seq);


    isCompletionEv(HistoryLabel);
    isCompletionREv(HistoryLabel);
    isInvocationEv(HistoryLabel);
    isInvocationREv(HistoryLabel);
}

\functions {
    any _;  /* universal variable */ // THIS IS INCORRECT AND SHOULD BE REMOVED!!

    \unique EventType iEv;
    \unique EventType iREv;
    \unique EventType cEv;
    \unique EventType cREv;
	   
    \unique HistoryLabel invocEv(ABSAnyInterface, ABSAnyInterface, Future, MethodLabel, Seq);
    \unique HistoryLabel invocREv(ABSAnyInterface, ABSAnyInterface, Future, MethodLabel, Seq);
    \unique HistoryLabel compEv(ABSAnyInterface, Future, MethodLabel, any);
    \unique HistoryLabel compREv(ABSAnyInterface, Future, any);

    Seq fid(Seq);

    // query functions

    any             getResult(HistoryLabel);
    Future          getFuture(HistoryLabel);
    MethodLabel     getMethod(HistoryLabel);
    Seq		    getArguments(HistoryLabel);
    ABSAnyInterface getCaller(HistoryLabel);

    HistoryLabel    getInvocationReactionEventForFuture(Seq, Future);
    HistoryLabel    getCompletionEventForFuture(Seq, Future);
    HistoryLabel    getCompletionReactionEventForFuture(Seq, Future);


    // getters 
    int             retrieve(Seq, EventType, ABSAnyInterface, Future, MethodLabel, any);
    Seq             retrieveAll(Seq, EventType, ABSAnyInterface, Future, MethodLabel, any);
}


\programVariables {
  Seq history;
}


\rules {

   /* use Java implementation */

   retrieve_Java {
     \schemaVar \term Seq evSeq;
     \schemaVar \term EventType et;
     \schemaVar \term ABSAnyInterface o;
     \schemaVar \term Future fut;
     \schemaVar \term MethodLabel m;
     \schemaVar \term Seq arg;

     \find (retrieve(evSeq,et,o,fut,m,arg))
     \replacewith(#retrieve(retrieve(evSeq,et,o,fut,m,arg))) 
   };

   retrieveAll_Java {
     \schemaVar \term Seq evSeq;
     \schemaVar \term EventType et;
     \schemaVar \term ABSAnyInterface o;
     \schemaVar \term Future fut;
     \schemaVar \term MethodLabel m;
     \schemaVar \term Seq arg;

     \find (retrieveAll(evSeq,et,o,fut,m,arg))
     \replacewith(#retrieveAll(retrieveAll(evSeq,et,o,fut,m,arg))) 
   };


    /* taclet rules for the retrieve and retrieveAll functions */

   noMatchedEvent {
     \schemaVar \term EventType et;
     \schemaVar \term ABSAnyInterface caller;
     \schemaVar \term Future fut;
     \schemaVar \term MethodLabel m;
     \schemaVar \term any r;

     \find (retrieve(seqEmpty,et,caller,fut,m,r))
     \replacewith(-1)
   };

   noMatchedEvent_All {
     \schemaVar \term EventType et;
     \schemaVar \term ABSAnyInterface caller;
     \schemaVar \term Future fut;
     \schemaVar \term MethodLabel m;
     \schemaVar \term any r;

     \find (retrieveAll(seqEmpty,et,caller,fut,m,r))   
     \replacewith(seqEmpty)
   };


   /* SEARCH FOR iEv */

   findiEvbutiREv {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface caller, callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq arg, arg2;

     \find (retrieve(seqConcat(prefix,seqSingleton(invocREv(caller,callee,fut,m,arg))),iEv,another,fut2,m2,arg2))
     \replacewith(retrieve(prefix,iEv,another,fut2,m2,arg2))
   };

   findiEvbutiREv_All {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface caller, callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq arg, arg2;

     \find (retrieveAll(seqConcat(prefix,seqSingleton(invocREv(caller,callee,fut,m,arg))),iEv,another,fut2,m2,arg2))
     \replacewith(retrieveAll(prefix,iEv,another,fut2,m2,arg2))
   };

   findiEvbutcEv {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term any result, result2;

     \find (retrieve(seqConcat(prefix,seqSingleton(compEv(callee,fut,m,result))),iEv,another,fut2,m2,result2))
     \replacewith(retrieve(prefix,iEv,another,fut2,m2,result2))
   };

   findiEvbutcEv_All {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term any result, result2;

     \find (retrieveAll(seqConcat(prefix,seqSingleton(compEv(callee,fut,m,result))),iEv,another,fut2,m2,result2))
     \replacewith(retrieveAll(prefix,iEv,another,fut2,m2,result2))
   };

   findiEvbutcREv {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface reciever, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term any result, result2;

     \find (retrieve(seqConcat(prefix,seqSingleton(compREv(reciever,fut,result))),iEv,another,fut2,m2,result2))
     \replacewith(retrieve(prefix,iEv,another,fut2,m2,result2))
   };

   findiEvbutcREv_All {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface reciever, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term any result, result2;

     \find (retrieveAll(seqConcat(prefix,seqSingleton(compREv(reciever,fut,result))),iEv,another,fut2,m2,result2))
     \replacewith(retrieveAll(prefix,iEv,another,fut2,m2,result2))
   };

   findiEvAxiom {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface caller, callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term EventType et;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq arg, arg2;

     \find (retrieve(seqConcat(prefix,seqSingleton(invocEv(caller,callee,fut,m,arg))),et,another,fut2,m2,arg2))
     // underscore is equal to anything  
     \replacewith(\if (et = iEv & callee = another & fut = fut2 & m = m2 & arg = arg2) \then (seqLen(prefix)) \else (retrieve(prefix,et,another,fut2,m2,arg2))) 
   };

   findiEvAxiom_All {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface caller, callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term EventType et;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq arg, arg2;

     \find (retrieveAll(seqConcat(prefix,seqSingleton(invocEv(caller,callee,fut,m,arg))),et,another,fut2,m2,arg2))
     // underscore is equal to anything 
     \replacewith(seqConcat(retrieveAll(prefix,et,another,fut2,m2,arg2), 
	     \if (et = iEv & callee = another & fut = fut2 & m = m2 & arg = arg2) \then ( seqSingleton(seqLen(prefix)) ) \else ( seqEmpty ) ) ) 
   };

   findiEvAxiomEQ {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface caller, callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term EventType et;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq arg, arg2, EQ;

     \assumes (seqConcat(prefix,seqSingleton(invocEv(caller,callee,fut,m,arg))) = EQ ==>)
     \find (retrieve(EQ,et,another,fut2,m2,arg2)) 
     \sameUpdateLevel
     \replacewith(\if (et = iEv & callee = another & fut = fut2 & m = m2 & arg = arg2) \then (seqLen(prefix)) \else (retrieve(prefix,et,another,fut2,m2,arg2))) 
     // underscore is equal to anything  
   };

   findiEvAxiomEQ_All {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface caller, callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term EventType et;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq arg, arg2, EQ;

     \assumes (seqConcat(prefix,seqSingleton(invocEv(caller,callee,fut,m,arg))) = EQ ==>)
     \find (retrieveAll(EQ,et,another,fut2,m2,arg2)) 
     \sameUpdateLevel
     // underscore is equal to anything 
     \replacewith(seqConcat(retrieveAll(prefix,et,another,fut2,m2,arg2), 
	     \if (et = iEv & callee = another & fut = fut2 & m = m2 & arg = arg2) \then ( seqSingleton(seqLen(prefix)) ) \else ( seqEmpty ) ) ) 
   };

   findiEvSimplify {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface caller, callee;
     \schemaVar \term Future fut;
     \schemaVar \term MethodLabel m;
     \schemaVar \term Seq arg;

     \find (retrieve(seqConcat(prefix,seqSingleton(invocEv(caller,callee,fut,m,arg))),iEv,callee,fut,m,arg))
     \replacewith(seqLen(prefix))
   };

   findiEvSimplify_All {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface caller, callee;
     \schemaVar \term Future fut;
     \schemaVar \term MethodLabel m;
     \schemaVar \term Seq arg;

     \find (retrieveAll(seqConcat(prefix,seqSingleton(invocEv(caller,callee,fut,m,arg))),iEv,callee,fut,m,arg))
     \replacewith(seqSingleton(seqLen(prefix)))
   };


   /* SEARCH FOR iREv */

   findiREvbutiEv {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface caller, callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq arg, arg2;

     \find (retrieve(seqConcat(prefix,seqSingleton(invocEv(caller,callee,fut,m,arg))),iREv,another,fut2,m2,arg2))
     \replacewith(retrieve(prefix,iREv,another,fut2,m2,arg2))
   };

   findiREvbutiEv_All {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface caller, callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq arg, arg2;

     \find (retrieveAll(seqConcat(prefix,seqSingleton(invocEv(caller,callee,fut,m,arg))),iREv,another,fut2,m2,arg2))
     \replacewith(retrieveAll(prefix,iREv,another,fut2,m2,arg2))
   };

   findiREvbutcEv {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term any result, result2;

     \find (retrieve(seqConcat(prefix,seqSingleton(compEv(callee,fut,m,result))),iREv,another,fut2,m2,result2))
     \replacewith(retrieve(prefix,iREv,another,fut2,m2,result2))
   };

   findiREvbutcEv_All {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term any result, result2;

     \find (retrieveAll(seqConcat(prefix,seqSingleton(compEv(callee,fut,m,result))),iREv,another,fut2,m2,result2))
     \replacewith(retrieveAll(prefix,iREv,another,fut2,m2,result2))
   };

   findiREvbutcREv {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface reciever, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term any result, result2;

     \find (retrieve(seqConcat(prefix,seqSingleton(compREv(reciever,fut,result))),iREv,another,fut2,m2,result2))
     \replacewith(retrieve(prefix,iREv,another,fut2,m2,result2))
   };

   findiREvbutcREv_All {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface reciever, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term any result, result2;

     \find (retrieveAll(seqConcat(prefix,seqSingleton(compREv(reciever,fut,result))),iREv,another,fut2,m2,result2))
     \replacewith(retrieveAll(prefix,iREv,another,fut2,m2,result2))
   };

   findiREvAxiom {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface caller, callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term EventType et;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq arg, arg2;

     \find (retrieve(seqConcat(prefix,seqSingleton(invocREv(caller,callee,fut,m,arg))),et,another,fut2,m2,arg2))
     // underscore is equal to anything  
     \replacewith(\if (et = iREv & caller = another & fut = fut2 & m = m2 & arg = arg2) \then (seqLen(prefix)) \else (retrieve(prefix,et,another,fut2,m2,arg2)))
   };

   findiREvAxiom_All {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface caller, callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term EventType et;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq arg, arg2;

     \find (retrieveAll(seqConcat(prefix,seqSingleton(invocEv(caller,callee,fut,m,arg))),et,another,fut2,m2,arg2))
     // underscore is equal to anything 
     \replacewith(seqConcat(retrieveAll(prefix,et,another,fut2,m2,arg2), 
	     \if (et = iREv & caller = another & fut = fut2 & m = m2 & arg = arg2) \then ( seqSingleton(seqLen(prefix)) ) \else ( seqEmpty ) ) ) 
   };

   findiREvAxiomEQ {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface caller, callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term EventType et;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq arg, arg2, EQ;

     \assumes (seqConcat(prefix,seqSingleton(invocEv(caller,callee,fut,m,arg))) = EQ ==>)
     \find (retrieve(EQ,et,another,fut2,m2,arg2)) 
     \sameUpdateLevel
     // underscore is equal to anything  
     \replacewith(\if (et = iREv & caller = another & fut = fut2 & m = m2 & arg = arg2) \then (seqLen(prefix)) \else (retrieve(prefix,et,another,fut2,m2,arg2))) 
   };

   findiREvAxiomEQ_All {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface caller, callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term EventType et;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq arg, arg2, EQ;

     \assumes (seqConcat(prefix,seqSingleton(invocREv(caller,callee,fut,m,arg))) = EQ ==>)
     \find (retrieveAll(EQ,et,another,fut2,m2,arg2)) 
     \sameUpdateLevel
     // underscore is equal to anything 
     \replacewith(seqConcat(retrieveAll(prefix,et,another,fut2,m2,arg2), 
	     \if (et = iREv & caller = another & fut = fut2 & m = m2 & arg = arg2) \then ( seqSingleton(seqLen(prefix)) ) \else ( seqEmpty ) ) ) 
   };

   findiREvSimplify {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface caller, callee;
     \schemaVar \term Future fut;
     \schemaVar \term MethodLabel m;
     \schemaVar \term Seq arg;

     \find (retrieve(seqConcat(prefix,seqSingleton(invocREv(caller,callee,fut,m,arg))),iREv,caller,fut,m,arg))
     \replacewith(seqLen(prefix))
   };

   findiREvSimplify_All {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface caller, callee;
     \schemaVar \term Future fut;
     \schemaVar \term MethodLabel m;
     \schemaVar \term Seq arg;

     \find (retrieveAll(seqConcat(prefix,seqSingleton(invocREv(caller,callee,fut,m,arg))),iREv,caller,fut,m,arg))
     \replacewith(seqSingleton(seqLen(prefix)))
   };

   /* SEARCH FOR cEv */

   findcEvbutiEv {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface caller, callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq arg, arg2;

     \find (retrieve(seqConcat(prefix,seqSingleton(invocEv(caller,callee,fut,m,arg))),cEv,another,fut2,m2,arg2))
     \replacewith(retrieve(prefix,cEv,another,fut2,m2,arg2))
   };

   findcEvbutiEv_All {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface caller, callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq arg, arg2;

     \find (retrieveAll(seqConcat(prefix,seqSingleton(invocEv(caller,callee,fut,m,arg))),cEv,another,fut2,m2,arg2))
     \replacewith(retrieveAll(prefix,cEv,another,fut2,m2,arg2))
   };

   findcEvbutiREv {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface caller, callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq arg, arg2;

     \find (retrieve(seqConcat(prefix,seqSingleton(invocREv(caller,callee,fut,m,arg))),cEv,another,fut2,m2,arg2))
     \replacewith(retrieve(prefix,cEv,another,fut2,m2,arg2))
   };

   findcEvbutiREv_All {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface caller, callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq arg, arg2;

     \find (retrieveAll(seqConcat(prefix,seqSingleton(invocREv(caller,callee,fut,m,arg))),cEv,another,fut2,m2,arg2))
     \replacewith(retrieveAll(prefix,cEv,another,fut2,m2,arg2))
   };

   findcEvbutcREv {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface reciever, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq arg, arg2;
     \schemaVar \term any result, result2;

     \find (retrieve(seqConcat(prefix,seqSingleton(compREv(reciever,fut,result))),cEv,another,fut2,m2,result2))
     \replacewith(retrieve(prefix,cEv,another,fut2,m2,result2))
   };

   findcEvbutcREv_All {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface reciever, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq arg, arg2;
     \schemaVar \term any result, result2;

     \find (retrieveAll(seqConcat(prefix,seqSingleton(compREv(reciever,fut,result))),cEv,another,fut2,m2,result2))
     \replacewith(retrieveAll(prefix,cEv,another,fut2,m2,result2))
   };

   findcEvAxiom {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term EventType et;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term any result, result2;

     \find (retrieve(seqConcat(prefix,seqSingleton(compEv(callee,fut,m,result))),et,another,fut2,m2,result2))
     \replacewith(\if (et = cEv & fut = fut2 & m = m2 & result = result2) \then (seqLen(prefix)) \else (retrieve(prefix,et,another,fut2,m2,result2)))
     // underscore is equal to anything  
   };

   findcEvAxiom_All {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term EventType et;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term any result, result2;

     \find (retrieveAll(seqConcat(prefix,seqSingleton(compEv(callee,fut,m,result))),et,another,fut2,m2,result2))
     // underscore is equal to anything 
     \replacewith(seqConcat(retrieveAll(prefix,et,another,fut2,m2,result2), 
	     \if (et = cEv & fut = fut2 & m = m2 & result = result2) \then ( seqSingleton(seqLen(prefix)) ) \else ( seqEmpty ) ) ) 
   };

   findcEvAxiomEQ {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term EventType et;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq EQ;
     \schemaVar \term any result, result2;

     \assumes (seqConcat(prefix,seqSingleton(compEv(callee,fut,m,result))) = EQ ==>)
     \find (retrieve(EQ,et,another,fut2,m2,result2)) 
     \sameUpdateLevel
     // underscore is equal to anything  
     \replacewith(\if (et = cEv & fut = fut2 & m = m2 & result = result2) \then (seqLen(prefix)) \else (retrieve(prefix,et,another,fut2,m2,result2))) 
   };

   findcEvAxiomEQ_All {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term EventType et;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq EQ;
     \schemaVar \term any result, result2;

     \assumes (seqConcat(prefix,seqSingleton(compEv(callee,fut,m,result))) = EQ ==>)
     \find (retrieveAll(EQ,et,another,fut2,m2,result2)) 
     \sameUpdateLevel
     // underscore is equal to anything 
     \replacewith(seqConcat(retrieveAll(prefix,et,another,fut2,m2,result2), 
	     \if (et = cEv & fut = fut2 & m = m2 & result = result2) \then ( seqSingleton(seqLen(prefix)) ) \else ( seqEmpty ) ) ) 
   };

   findcEvSimplify {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface callee;
     \schemaVar \term Future fut;
     \schemaVar \term MethodLabel m;
     \schemaVar \term any result;

     \find (retrieve(seqConcat(prefix,seqSingleton(compEv(callee,fut,m,result))),cEv,callee,fut,m,result))
     \replacewith(seqLen(prefix))
   };

   findcEvSimplify_All {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface callee;
     \schemaVar \term Future fut;
     \schemaVar \term MethodLabel m;
     \schemaVar \term any result;

     \find (retrieveAll(seqConcat(prefix,seqSingleton(compEv(callee,fut,m,result))),cEv,callee,fut,m,result))
     \replacewith(seqSingleton(seqLen(prefix)))
   };

   /* SEARCH FOR cREv */

   findcREvbutiEv {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface caller, callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq arg, arg2;

     \find (retrieve(seqConcat(prefix,seqSingleton(invocEv(caller,callee,fut,m,arg))),cREv,another,fut2,m2,arg2))
     \replacewith(retrieve(prefix,cREv,another,fut2,m2,arg2))
   };

   findcREvbutiEv_All {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface caller, callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq arg, arg2;

     \find (retrieveAll(seqConcat(prefix,seqSingleton(invocEv(caller,callee,fut,m,arg))),cREv,another,fut2,m2,arg2))
     \replacewith(retrieveAll(prefix,cREv,another,fut2,m2,arg2))
   };

   findcREvbutiREv {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface caller, callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq arg, arg2;

     \find (retrieve(seqConcat(prefix,seqSingleton(invocREv(caller,callee,fut,m,arg))),cREv,another,fut2,m2,arg2))
     \replacewith(retrieve(prefix,cREv,another,fut2,m2,arg2))
   };

   findcREvbutiREv_All {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface caller, callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq arg, arg2;

     \find (retrieveAll(seqConcat(prefix,seqSingleton(invocREv(caller,callee,fut,m,arg))),cREv,another,fut2,m2,arg2))
     \replacewith(retrieveAll(prefix,cREv,another,fut2,m2,arg2))
   };

   findcREvbutcEv {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term any result, result2;

     \find (retrieve(seqConcat(prefix,seqSingleton(compEv(callee,fut,m,result))),cREv,another,fut2,m2,result2))
     \replacewith(retrieve(prefix,cREv,another,fut2,m2,result2))
   };

   findcREvbutcEv_All {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface callee, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term any result, result2;

     \find (retrieveAll(seqConcat(prefix,seqSingleton(compEv(callee,fut,m,result))),cREv,another,fut2,m2,result2))
     \replacewith(retrieveAll(prefix,cREv,another,fut2,m2,result2))
   };

   findcREvAxiom {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface reciever, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term EventType et;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term any result, result2;

     \find (retrieve(seqConcat(prefix,seqSingleton(compREv(reciever,fut,result))),et,another,fut2,m2,result2))
     // underscore is equal to anything  
     \replacewith(\if (et = cREv & fut = fut2 & result = result2) \then (seqLen(prefix)) \else (retrieve(prefix,et,another,fut2,m2,result2)))
   };

   findcREvAxiom_All {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface reciever, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term EventType et;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term any result, result2;

     \find (retrieveAll(seqConcat(prefix,seqSingleton(compREv(reciever,fut,result))),et,another,fut2,m2,result2))
     // underscore is equal to anything 
     \replacewith(seqConcat(retrieveAll(prefix,et,another,fut2,m2,result2), 
	     \if (et = cREv & fut = fut2 & result = result2) \then ( seqSingleton(seqLen(prefix)) ) \else ( seqEmpty ) ) ) 
   };

   findcREvAxiomEQ {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface reciever, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term EventType et;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq EQ;
     \schemaVar \term any result, result2;

     \assumes (seqConcat(prefix,seqSingleton(compREv(reciever,fut,result))) = EQ ==>)
     \find (retrieve(EQ,et,another,fut2,m2,result2)) 
     \sameUpdateLevel
     // underscore is equal to anything  
     \replacewith(\if (et = cREv & fut = fut2 & result = result2) \then (seqLen(prefix)) \else (retrieve(prefix,et,another,fut2,m2,result2))) 
   };

   findcREvAxiomEQ_All {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface reciever, another;
     \schemaVar \term Future fut, fut2;
     \schemaVar \term EventType et;
     \schemaVar \term MethodLabel m, m2;
     \schemaVar \term Seq EQ;
     \schemaVar \term any result, result2;

     \assumes (seqConcat(prefix,seqSingleton(compREv(reciever,fut,result))) = EQ ==>)
     \find (retrieveAll(EQ,et,another,fut2,m2,result2)) 
     \sameUpdateLevel
     // underscore is equal to anything 
     \replacewith(seqConcat(retrieveAll(prefix,et,another,fut2,m2,result2), 
	     \if (et = cREv & fut = fut2 & result = result2) \then ( seqSingleton(seqLen(prefix)) ) \else ( seqEmpty ) ) ) 
   };

   findcREvSimplify {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface reciever;
     \schemaVar \term Future fut;
     \schemaVar \term MethodLabel m;
     \schemaVar \term any result;

     \find (retrieve(seqConcat(prefix,seqSingleton(compREv(reciever,fut,result))),cREv,reciever,fut,m,result))
     \replacewith(seqLen(prefix))
   };

   findcREvSimplify_All {
     \schemaVar \term Seq prefix;
     \schemaVar \term ABSAnyInterface reciever;
     \schemaVar \term Future fut;
     \schemaVar \term MethodLabel m;
     \schemaVar \term any result;

     \find (retrieveAll(seqConcat(prefix,seqSingleton(compREv(reciever,fut,result))),cREv,reciever,fut,m,result))
     \replacewith(seqConcat(retrieveAll(prefix,cREv,reciever,fut,m,result), seqSingleton(seqLen(prefix))))
   };

   /* startsWith and endsWith */

   startsWithDef {
      \schemaVar \term Seq historySV, prefix;

      \find (startsWith(historySV, prefix))
      \replacewith(seqLen(historySV) >= seqLen(prefix) &
                   seqSub(historySV, 0, seqLen(prefix)) = prefix)
      \heuristics(simplify_enlarging)
   };


   endsWithDef {
      \schemaVar \term Seq historySV, suffix;

      \find (endsWith(historySV, suffix))
      \replacewith(seqLen(historySV) >= seqLen(suffix) &
                   seqSub(historySV, seqLen(historySV) - seqLen(suffix),
                   seqLen(historySV)) = suffix)
      \heuristics(simplify_enlarging)
   };


   /* getResult */

   getResultFromCompEv {
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term any result;
	 
   	\find (getResult(compEv(callee, fut, meth, result)))
   	\replacewith(result)
   	\heuristics(simplify)
   };

   getResultFromCompREv {
   	\schemaVar \term ABSAnyInterface receiver;
   	\schemaVar \term Future fut;
   	\schemaVar \term any result;

   	\find (getResult(compREv(receiver, fut, result)))
   	\replacewith(result)
   	\heuristics(simplify)
   };

   getResultFromCompEvEQ {
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term any result;
   	\schemaVar \term HistoryLabel EQ;

   	\assumes (compEv(callee, fut, meth, result) = EQ ==>)
   	\find (getResult(EQ))
   	\sameUpdateLevel
   	\replacewith(result)
   	\heuristics(simplify)
   };

   getResultFromCompREvEQ {
   	\schemaVar \term ABSAnyInterface receiver;
   	\schemaVar \term Future fut;
   	\schemaVar \term any result;
   	\schemaVar \term HistoryLabel EQ;

   	\assumes (compREv(receiver, fut, result) = EQ ==>)
   	\find (getResult(EQ))
   	\sameUpdateLevel
   	\replacewith(result)
   	\heuristics(simplify)
   };


   /* getFuture */

   getFutureFromCompEv {
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term any result;
   	\find (getFuture(compEv(callee, fut, meth, result)))
   	\replacewith(fut)
   	\heuristics(simplify)
   };

   getFutureFromCompREv {
   	\schemaVar \term ABSAnyInterface receiver;
   	\schemaVar \term Future fut;
   	\schemaVar \term any result;
   	\find (getFuture(compREv(receiver, fut, result)))
   	\replacewith(fut)
   	\heuristics(simplify)
   };

   getFutureFromCompEvEQ {
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term any result;
   	\schemaVar \term HistoryLabel EQ;
   	
   	\assumes (compEv(callee, fut, meth, result) = EQ ==>)
   	\find (getFuture(EQ))
   	\sameUpdateLevel
   	\replacewith(fut)
   	\heuristics(simplify)
   };

   getFutureFromCompREvEQ {
   	\schemaVar \term ABSAnyInterface receiver;
   	\schemaVar \term Future fut;
   	\schemaVar \term any result;
   	\schemaVar \term HistoryLabel EQ;

   	\assumes (compREv(receiver, fut, result) = EQ ==>)
   	\find (getFuture(EQ))
   	\sameUpdateLevel
   	\replacewith(fut)
   	\heuristics(simplify)
   };

   getFutureFromInvocEv {
   	\schemaVar \term ABSAnyInterface caller, callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;
   	
   	\find(getFuture(invocEv(caller, callee, fut, meth, args)))
   	\replacewith(fut)
   	\heuristics(simplify)
   };

   getFutureFromInvocREv {
   	\schemaVar \term ABSAnyInterface caller, callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;

   	\find (getFuture(invocREv(caller, callee, fut, meth, args)))
   	\replacewith(fut)
   	\heuristics(simplify)
   };

   getFutureFromInvocEvEQ {
   	\schemaVar \term ABSAnyInterface caller, callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;
   	\schemaVar \term HistoryLabel EQ;
   	
   	\assumes (invocEv(caller, callee, fut, meth, args) = EQ ==>)
   	\find (getFuture(EQ))
   	\sameUpdateLevel
   	\replacewith(fut)
   	\heuristics(simplify)
   };

   getFutureFromInvocREvEQ {
   	\schemaVar \term ABSAnyInterface caller, callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;
   	\schemaVar \term HistoryLabel EQ;

   	\assumes (invocREv(caller, callee, fut, meth, args) = EQ ==>)
   	\find (getFuture(EQ))
   	\sameUpdateLevel
   	\replacewith(fut)
   	\heuristics(simplify)
   };


   /* getMethod */

   getMethodFromCompEv {
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term any result;

   	\find (getMethod(compEv(callee, fut, meth, result)))
   	\replacewith(meth)
   	\heuristics(simplify)
   };


   getMethodFromCompEvEQ {
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term any result;
   	\schemaVar \term HistoryLabel EQ;
   	
   	\assumes (compEv(callee, fut, meth, result) = EQ ==>)
   	\find (getMethod(EQ))
   	\sameUpdateLevel
   	\replacewith(meth)
   	\heuristics(simplify)
   };


   getMethodFromInvocEv {
   	\schemaVar \term ABSAnyInterface caller, callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;
   	
   	\find(getMethod(invocEv(caller, callee, fut, meth, args)))
   	\replacewith(meth)
   	\heuristics(simplify)
   };

   getMethodFromInvocREv {
   	\schemaVar \term ABSAnyInterface caller, callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;

   	\find (getMethod(invocREv(caller, callee, fut, meth, args)))
   	\replacewith(meth)
   	\heuristics(simplify)
   };

   getMethodFromInvocEvEQ {
   	\schemaVar \term ABSAnyInterface caller, callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;
   	\schemaVar \term HistoryLabel EQ;
   	
   	\assumes (invocEv(caller, callee, fut, meth, args) = EQ ==>)
   	\find (getMethod(EQ))
   	\sameUpdateLevel
   	\replacewith(meth)
   	\heuristics(simplify)
   };

   getMethodFromInvocREvEQ {
   	\schemaVar \term ABSAnyInterface caller, callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;
   	\schemaVar \term HistoryLabel EQ;

   	\assumes (invocREv(caller, callee, fut, meth, args) = EQ ==>)
   	\find (getMethod(EQ))
   	\sameUpdateLevel
   	\replacewith(meth)
   	\heuristics(simplify)
   };


   /* getCaller */

   getCallerFromInvocEv {
   	\schemaVar \term ABSAnyInterface caller, callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;
   	
   	\find(getCaller(invocEv(caller, callee, fut, meth, args)))
   	\replacewith(caller)
   	\heuristics(simplify)
   };

   getCallerFromInvocREv {
   	\schemaVar \term ABSAnyInterface caller, callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;

   	\find (getCaller(invocREv(caller, callee, fut, meth, args)))
   	\replacewith(caller)
   	\heuristics(simplify)
   };

   getCallerFromInvocEvEQ {
   	\schemaVar \term ABSAnyInterface caller, callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;
   	\schemaVar \term HistoryLabel EQ;
   	
   	\assumes (invocEv(caller, callee, fut, meth, args) = EQ ==>)
   	\find (getCaller(EQ))
   	\sameUpdateLevel
   	\replacewith(caller)
   	\heuristics(simplify)
   };

   getCallerFromInvocREvEQ {
   	\schemaVar \term ABSAnyInterface caller, callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;
   	\schemaVar \term HistoryLabel EQ;

   	\assumes (invocREv(caller, callee, fut, meth, args) = EQ ==>)
   	\find (getCaller(EQ))
   	\sameUpdateLevel
   	\replacewith(caller)
   	\heuristics(simplify)
   };


   /* CHECK FOR EVENT KINDS */

   isCompletionEvent {
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term any result;
   	\schemaVar \term HistoryLabel EQ;

   	\find (isCompletionEv(compEv(callee, fut, meth, result)))
   	\replacewith(true)
   	\heuristics(concrete)
   };

   isCompletionEventDef {
   	\schemaVar \variables ABSAnyInterface callee;
   	\schemaVar \variables Future fut;
   	\schemaVar \variables MethodLabel meth;
   	\schemaVar \variables any result;
   	\schemaVar \term HistoryLabel ev;

   	\find (isCompletionEv(ev))
	\varcond(\notFreeIn(callee, ev), \notFreeIn(fut, ev), \notFreeIn(meth, ev), \notFreeIn(result, ev))
	\replacewith(\exists callee;\exists fut;\exists meth;\exists result;(compEv(callee, fut, meth, result)=ev))
   	\heuristics(simplify)
   };

   isCompletionEventFalse1 {
   	\schemaVar \term ABSAnyInterface caller;
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;
   	
   	\find (isCompletionEv(invocEv(caller, callee, fut, meth, args)))
   	\replacewith(false)
   	\heuristics(simplify)
   };


   isCompletionEventFalse2 {
   	\schemaVar \term ABSAnyInterface caller;
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;
   	
   	\find (isCompletionEv(invocREv(caller, callee, fut, meth, args)))
   	\replacewith(false)
   	\heuristics(simplify)
   };


   isCompletionEventFalse3 {
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term any result;
   	
   	\find (isCompletionEv(compREv(callee, fut, result)))
   	\replacewith(false)
   	\heuristics(simplify)
   };

   isCompletionEventEQ {
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term any result;
   	\schemaVar \term HistoryLabel EQ;

	\assumes (compEv(callee, fut, meth, result) = EQ ==>)
   	\find (isCompletionEv(EQ))
   	\sameUpdateLevel
   	\replacewith(true)
   	\heuristics(concrete)
   };

   isCompletionReactionEvent {
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term any result;

   	\find (isCompletionREv(compREv(callee, fut, result)))
   	\replacewith(true)
   	\heuristics(concrete)
   };

   isCompletionReactionEventEQ {
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term any result;
   	\schemaVar \term HistoryLabel EQ;
   	
   	\assumes(EQ = compREv(callee, fut, result) ==>)
   	\find (isCompletionREv(EQ))
   	\sameUpdateLevel   	
   	\replacewith(true)
   	\heuristics(concrete)
   };

   isCompletionReactionEventFalse1 {
   	\schemaVar \term ABSAnyInterface caller;
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;
   	
   	\find (isCompletionREv(invocEv(caller, callee, fut, meth, args)))
   	\replacewith(false)
   	\heuristics(simplify)
   };


   isCompletionReactionEventFalse2 {
   	\schemaVar \term ABSAnyInterface caller;
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;
   	
   	\find (isCompletionREv(invocREv(caller, callee, fut, meth, args)))
   	\replacewith(false)
   	\heuristics(simplify)
   };


   isCompletionReactionEventFalse3 {
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
 	\schemaVar \term MethodLabel meth;
   	\schemaVar \term any result;
   	
   	\find (isCompletionREv(compEv(callee, fut, meth, result)))
   	\replacewith(false)
   	\heuristics(simplify)
   };

   isCompletionReactionEventGeneral {
   	\schemaVar \variables ABSAnyInterface callee;
   	\schemaVar \variables Future fut;
   	\schemaVar \variables any result;
    \schemaVar \term HistoryLabel l;

   	\find (isCompletionREv(l))
   	\varcond (\notFreeIn(callee, l), \notFreeIn(fut, l), \notFreeIn(result, l))
   	\replacewith(\exists callee; \exists fut; \exists result; (l=compREv(callee, fut, result)))
   	\heuristics(simplify)
   };  
   
    /* getArguments */

    getArgumentsFromInvocEv {
   	\schemaVar \term ABSAnyInterface caller, callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;
   	\schemaVar \term HistoryLabel EQ;
   	
   	\find (getArguments(invocEv(caller, callee, fut, meth, args) ))
   	\sameUpdateLevel
   	\replacewith(args)
   	\heuristics(simplify)
   };

   getArgumentsFromInvocEvEQ {
   	\schemaVar \term ABSAnyInterface caller, callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;
   	\schemaVar \term HistoryLabel EQ;
   	
   	\assumes (invocEv(caller, callee, fut, meth, args) = EQ ==>)
   	\find (getArguments(EQ))
   	\sameUpdateLevel
   	\replacewith(args)
   	\heuristics(simplify)
   };

   getArgumentsFromInvocREv {
   	\schemaVar \term ABSAnyInterface caller, callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;

   	\find (getArguments(invocREv(caller, callee, fut, meth, args)))
   	\replacewith(args)
   	\heuristics(simplify)
   };

   getArgumentsFromInvocREvEQ {
   	\schemaVar \term ABSAnyInterface caller, callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;
   	\schemaVar \term HistoryLabel EQ;

   	\assumes (invocREv(caller, callee, fut, meth, args) = EQ ==>)
   	\find (getArguments(EQ))
   	\sameUpdateLevel
   	\replacewith(args)
   	\heuristics(simplify)
   };

   isInvocationEvent {
   	\schemaVar \term ABSAnyInterface caller, callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;

   	\find (isInvocationEv(invocEv(caller, callee, fut, meth, args)))
   	\replacewith(true)
   	\heuristics(simplify)
   };

   isInvocationReactionEvent {
   	\schemaVar \term ABSAnyInterface caller, callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;
   	
   	\find (isInvocationREv(invocREv(caller, callee, fut, meth, args)))
   	\replacewith(true)
   	\heuristics(simplify)
   };

   isInvocationEventEQ {
   	\schemaVar \term ABSAnyInterface caller, callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;
   	\schemaVar \term HistoryLabel EQ;
   	
	\assumes (invocEv(caller, callee, fut, meth, args) = EQ ==>)
   	\find (isInvocationEv(EQ))
   	\sameUpdateLevel
   	
   	\replacewith(true)
   	\heuristics(simplify)
   };

   isInvocationReactionEventEQ {
   	\schemaVar \term ABSAnyInterface caller, callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;
   	\schemaVar \term HistoryLabel EQ;
   	
   	\assumes (invocREv(caller, callee, fut, meth, args) = EQ ==>)
   	\find (isInvocationREv(EQ))
   	\sameUpdateLevel   
   		
   	\replacewith(true)
   	\heuristics(simplify)
   };


   isInvocationEventFalse1 {
   	\schemaVar \term ABSAnyInterface caller;
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;
   	
   	\find (isInvocationEv(invocREv(caller, callee, fut, meth, args)))
   	\replacewith(false)
   	\heuristics(simplify)
   };

   isInvocationEventFalse2 {
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term any result;

   	\find (isInvocationEv(compEv(callee, fut, meth, result)))
   	\replacewith(false)
   	\heuristics(simplify)
   };

   isInvocationEventFalse3 {
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term any result;

   	\find (isInvocationEv(compREv(callee, fut, result)))
   	\replacewith(false)
   	\heuristics(simplify)
   };


   isInvocationReactionEventFalse1 {
   	\schemaVar \term ABSAnyInterface caller;
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;
   	
   	\find (isInvocationREv(invocEv(caller, callee, fut, meth, args)))
   	\replacewith(false)
   	\heuristics(simplify)
   };

   isInvocationReactionEventFalse2 {
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term any result;
   	
   	\find (isInvocationREv(compEv(callee, fut, meth, result)))
   	\replacewith(false)
   	\heuristics(simplify)
   };

   isInvocationReactionEventFalse3 {
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term any result;
   	
   	\find (isInvocationREv(compREv(callee, fut, result)))
   	\replacewith(false)
   	\heuristics(simplify)
   };

   isInvocationEventEQFalse1 {
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term any result;
   	\schemaVar \term HistoryLabel EQ;
   	
	\assumes (compEv(callee, fut, meth, result) = EQ ==>)
   	\find (isInvocationEv(EQ))
  	\sameUpdateLevel
   	\replacewith(false)
   	\heuristics(simplify)
   };

   isInvocationEventEQFalse2 {
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term any result;
   	\schemaVar \term HistoryLabel EQ;
   	
	\assumes (compREv(callee, fut, result) = EQ ==>)
   	\find (isInvocationEv(EQ))
  	\sameUpdateLevel
   	\replacewith(false)
   	\heuristics(simplify)
   };
   
   isInvocationReactionEventEQFalse1 {
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term any result;
   	\schemaVar \term HistoryLabel EQ;
   
   	\assumes (compREv(callee, fut, result) = EQ ==>)
   	\find (isInvocationREv(EQ))
  	\sameUpdateLevel
   	\replacewith(false)
   	\heuristics(simplify)
   };

   isInvocationReactionEventEQFalse2 {
   	\schemaVar \term ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term any result;
   	\schemaVar \term HistoryLabel EQ;

   	
   	\assumes (compEv(callee, fut, meth, result) = EQ ==>)
   	\find (isInvocationREv(EQ))
  	\sameUpdateLevel
   	
   	\replacewith(false)
   	\heuristics(simplify)
   };


  /* HISTORY WELL-FORMEDNESS */
 
  /* containsFutureDef {  	
	\find (containsFuture(fut, fid(history)))
	\replacewith (\exists i;(i>=0 & i<seqLen(fid(history); any::seqGet(fid(history), i) = fut)))	
  };*/
 
  wellFormedInvocationEvent {
  	\schemaVar \term ABSAnyInterface caller, callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;
   	\schemaVar \term Seq historySV;


  	\find(wfHist(seqConcat(historySV, seqSingleton(invocEv(caller, callee, fut, meth, args)))))
  	\replacewith(wfHist(historySV) & caller != null & callee != null & !containsFuture(fut, fid(historySV)))
  	\heuristics(simplify)
  };

 

  wellFormedInvocationEventEQ {
  	\schemaVar \term ABSAnyInterface caller, callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;
   	\schemaVar \term Seq EQ;
   	\schemaVar \term Seq historySV;


	\assumes (seqConcat(historySV, seqSingleton(invocEv(caller, callee, fut, meth, args))) = EQ ==>)
  	\find(wfHist(EQ))
  	\sameUpdateLevel
  	
  	\replacewith(wfHist(historySV) & caller != null & callee != null & !containsFuture(fut, fid(historySV)))
  	\heuristics(simplify)
  };

  wellFormedInvocationEventPreceedsInvocationReactionEvent {
  	\schemaVar \term ABSAnyInterface caller, callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;
    \schemaVar \term Seq historySV;

  	\find(wfHist(seqConcat(historySV, seqSingleton(invocREv(caller, callee, fut, meth, args)))))
  	\replacewith(wfHist(historySV) & caller != null & callee != null
  	     & !containsEvent(invocREv(caller, callee, fut, meth, args), historySV)
  	     &  containsEvent(invocEv(caller, callee, fut, meth, args), historySV))
  	\heuristics(simplify)
  };

  wellFormedInvocationEventPreceedsInvocationReactionEventEQ {
  	\schemaVar \term ABSAnyInterface caller, callee;
   	\schemaVar \term Future fut;
   	\schemaVar \term MethodLabel meth;
   	\schemaVar \term Seq args;
   	\schemaVar \term Seq EQ;
   	\schemaVar \term Seq historySV;


    \assumes(seqConcat(historySV, seqSingleton(invocREv(caller, callee, fut, meth, args))) = EQ ==>)
  	\find(wfHist(EQ))
  	\replacewith(wfHist(historySV) & caller != null & callee != null
  	     & !containsEvent(invocREv(caller, callee, fut, meth, args), historySV)
  	     &  containsEvent(invocEv(caller, callee, fut, meth, args), historySV))
  	\heuristics(simplify)
  };

  wellFormedCompletionEventPreceedsCompletionReactionEvent {
  	\schemaVar \term ABSAnyInterface caller;
   	\schemaVar \variables ABSAnyInterface callee;
   	\schemaVar \term Future fut;
   	\schemaVar \variables MethodLabel meth;
   	\schemaVar \term any result;
   	\schemaVar \term Seq historySV;

  	\find(wfHist(seqConcat(historySV, seqSingleton(compREv(caller, fut, result)))))
  	\varcond(\notFreeIn(callee, result), \notFreeIn(meth, result, fut, historySV),
  	         \notFreeIn(callee, result, fut, historySV))
  	\replacewith(wfHist(historySV) & caller != null
  	     &  \exists callee; \exists meth; (callee != null &
  	            containsEvent(compEv(callee, fut, meth, result), historySV)))
  	\heuristics(simplify)
  };

  wellFormedCompletionEventPreceedsCompletionReactionEventEQ {
  	\schemaVar \term ABSAnyInterface caller;
   	\schemaVar \term Future fut;
   	\schemaVar \variables ABSAnyInterface callee;
   	\schemaVar \variables MethodLabel meth;
   	\schemaVar \term any result;
   	\schemaVar \term Seq historySV;
   	\schemaVar \term Seq EQ;


  	\assumes(seqConcat(historySV, seqSingleton(compREv(caller, fut, result)))=EQ ==>)
  	\find(wfHist(EQ))
  	\varcond(\notFreeIn(callee, result), \notFreeIn(meth, result, fut, historySV),
  	         \notFreeIn(callee, result, fut, historySV))
  	\replacewith(wfHist(historySV) & caller != null
  	     &  \exists callee; \exists meth; (callee != null &
  	            containsEvent(compEv(callee, fut, meth, result), historySV)) )
  	\heuristics(simplify)
  };


  /* SEQUENCE */

  emptySeqLeft {
    \schemaVar \term Seq seq;
    \find (seqConcat(seqEmpty, seq))
    \replacewith(seq)
    \heuristics(simplify)
  };

  emptySeqRight {
    \schemaVar \term Seq seq;
    \find (seqConcat(seq, seqEmpty))
    \replacewith(seq)
    \heuristics(simplify)
  };

  emptySeqRightEQ {
    \schemaVar \term Seq seqLeft, seqRight;
    \assumes(seqLen(seqRight)=0 ==>)
    \find (seqConcat(seqLeft, seqRight)) \sameUpdateLevel
    \replacewith(seqLeft)
    \heuristics(simplify)
  };

  emptySeqLeftEQ {
    \schemaVar \term Seq seqLeft, seqRight;
    \assumes(seqLen(seqLeft)=0 ==>)
    \find (seqConcat(seqLeft, seqRight)) \sameUpdateLevel
    \replacewith(seqRight)
    \heuristics(simplify)
  };

  seqSubSingle {
    \schemaVar \term any el;
    \find(seqSub(seqSingleton(el), 0, 1))
    \replacewith(seqSingleton(el))
    \heuristics(simplify)
  };

  seqSingletonEqual {
    \schemaVar \term any el1, el2;
    \find(seqSingleton(el1) = seqSingleton(el2))
    \replacewith(el1 = el2)
    \heuristics(simplify)
  };
}
