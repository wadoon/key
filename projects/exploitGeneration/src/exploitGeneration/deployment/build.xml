<?xml version="1.0" encoding="UTF-8"?>
<project name="de.tud.expoitgen" default="jar" basedir=".">
	
   <!--##################################################################### -->
   <!--## Run a target from the Outline as "ant build" and refresh        ## -->
   <!--## folder "deployment" in package/project explorer when finished.  ## -->
   <!--## - compile: Compiles sources and provides required resources     ## -->
   <!--## - jar: Creates a JAR file and Java Web Start                    ## -->
   <!--## - doc: Generates java doc files                                 ## -->
   <!--## - clean: Deletes all files created via this ant script          ## -->
   <!--##################################################################### -->
	
   <property environment="env" /> <!-- include environment variables -->

   <property name="src.dir"   value="${basedir}/../src" />
   <property name="lib.dir"  value="${basedir}/../lib" />
	<!--<property name="resources.dir"  value="${basedir}/../resources" /> -->
   <property name="build.dir" value="${basedir}/bin" />
   <property name="jar.dir" value="${basedir}/jar" />
   <property name="doc.dir" value="${basedir}/doc" />
	
	<property name="key.dir" value="${basedir}/../../../../.."/>
	<property name="keytestgen.dir" value="${key.dir}/projects/keytestgen"/>
	
	<!-- delete curent key.jar and keytestgen.jar in lib directory -->
	 <delete file="${lib.dir}/key.jar"/>
	<delete file="${lib.dir}/keytestgen.jar"/>
	<!-- copy newest key.jar and keytestgen.jar-->
	<copy file="${key.dir}/system/key.jar" tofile="${lib.dir}/key.jar"/>
	<copy file="${keytestgen.dir}/deployment/jar/keytestgen.jar" tofile="${lib.dir}/keytestgen.jar"/>
	
	<!-- generating IsccResultParser -->
	 <target name="IsccResult" >
		<echo message="Running antlr ..."/>
	        <java jar="${lib.dir}/antlr-4.5.1-complete.jar" fork="true" failonerror="true">
	        <arg value="-o" />
	        <arg value="${src.dir}/de/tud/exploitgen/findsecret/libinterface/gensrc" />
	        <arg value="${src.dir}/de/tud/exploitgen/findsecret/libinterface/gensrc/CountingResult.g4" />
	     </java>
	 </target>
	
   <target name="compile" description="Compile all java files into the target directory.">
      <mkdir dir="${build.dir}"/>
   	<!--
      <copy todir="${build.dir}">
         <fileset dir="${resources.dir}"/>
      </copy>
      -->
      <javac srcdir= "${src.dir}" destdir="${build.dir}" includeantruntime="false" source="1.7" deprecation="off" debug="on" depend="${build.depend}" optimize="off">
         <classpath>
            <pathelement location="${lib.dir}/commons-math3-3.0.jar"/>
            <pathelement location="${lib.dir}/commons-io-2.4.jar"/>
            <pathelement location="${lib.dir}/jcommander-1.32.jar"/>
         	<pathelement location="${lib.dir}/antlr-4.5.1-complete.jar"/>
            <pathelement location="${lib.dir}/key.jar"/>
            <pathelement location="${lib.dir}/keytestgen.jar"/>
            <pathelement location="${lib.dir}/com.microsoft.z3.jar"/>
         </classpath>
      </javac>
   </target>

   <target name="jar" depends="compile" description="Create JAR archive from compiled files and resources.">
      <mkdir dir="${jar.dir}"/>
      <copy todir="${jar.dir}">
         <fileset dir="${lib.dir}"/>
      </copy>
      <jar destfile="${jar.dir}/exploitgen.jar" basedir="${build.dir}" manifest="${basedir}/MANIFEST.MF" />
   	<!--
      <copy todir="${jar.dir}">
         <fileset file="TheQuiz.jnlp"/>
         <fileset file="J2EEApplicationClient24.gif"/>
      </copy>
      -->
   	<!--
      <delete failonerror="true" includeemptydirs="true"> 
         <fileset file="${jar.dir}/TheQuizStore"/>
      </delete>
      <genkey alias="Software Engineering Group" storepass="secret" keystore="${jar.dir}/TheQuizStore">
         <dname>
            <param name="CN" value="Software Engineering Group"/>
            <param name="OU" value="Fachbereich Informatik"/>
            <param name="O"  value="Technische UniversitÃ¤t Darmstadt"/>
            <param name="C"  value="DE"/>
         </dname>
      </genkey>
      <signjar jar="${jar.dir}/TheQuiz.jar" alias="Software Engineering Group" keystore="${jar.dir}/TheQuizStore" storepass="secret"/>
      <signjar jar="${jar.dir}/jlfgr-1.0.jar" alias="Software Engineering Group" keystore="${jar.dir}/TheQuizStore" storepass="secret"/>
      -->
   </target>
        
   <target name="doc" description="Generate JavaDoc.">
      <mkdir dir="${doc.dir}"/>
      <javadoc destdir="${doc.dir}" access="private">
         <fileset dir="${src.dir}" defaultexcludes="yes" />
      </javadoc>
   </target>

   <target name="clean" description="Delete target directories.">
      <delete includeemptydirs="true" quiet="true"> 
         <fileset dir="${build.dir}"/>
         <fileset dir="${jar.dir}"/>
         <fileset dir="${doc.dir}"/>
      </delete>
   </target>
</project>