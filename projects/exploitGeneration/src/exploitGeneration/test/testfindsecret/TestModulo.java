package testfindsecret;

import org.junit.*;
import junit.framework.TestCase;
import java.lang.reflect.*;
import java.util.*;
import findsecret.Modulo;

public  class TestModulo extends TestCase {
    
    /**
     * check method calculate with noninterference specification: l
     * | h
     */
    
    @Test
    public void test_calculate_self_l_0 ()
        throws NoSuchFieldException, SecurityException, IllegalArgumentException, IllegalAccessException {
        
        /*
         * Prepare for execution 1
         */
        Modulo self_1 = new Modulo();        
        int self_l_1 = 3;        
        int self_h_1 = 1;        
        
        /*
         * Configure variable: self_1
         */
        setFieldValue(self_1,"l",self_l_1);        
        setFieldValue(self_1,"h",self_h_1);        
        
        /*
         * Perform execution 1
         */
        self_1.calculate();        
        
        /*
         * Get the value of low variable self_l after execution 1
         */
        int self_l_out_1 = ((Integer)getFieldValue(self_1,"l")).intValue();
        
        /*
         * Prepare for execution 2
         */
        Modulo self_2 = new Modulo();        
        int self_l_2 = 3;        
        int self_h_2 = 2;        
        
        /*
         * Configure variable: self_2
         */
        setFieldValue(self_2,"l",self_l_2);        
        setFieldValue(self_2,"h",self_h_2);        
        
        /*
         * Perform execution 2
         */
        self_2.calculate();        
        
        /*
         * Get the value of low variable self_l after execution 2
         */
        int self_l_out_2 = ((Integer)getFieldValue(self_2,"l")).intValue();
        
        assertNotNull(self_l_out_1);        
        assertNotNull(self_l_out_2);        
        /*
         * assert that the value of low variable self_l is not changed after performing
         * two executions
         */
        assertTrue(self_l_out_1 == self_l_out_2);        
    }
    
    /**
     * Sets a field of some object to a given value
     */
    private void setFieldValue (Object instance, String fieldName, Object value)
        throws NoSuchFieldException, SecurityException, IllegalArgumentException, IllegalAccessException {
        Field field = instance.getClass().getDeclaredField(fieldName);        
        field.setAccessible(true);        
        field.set(instance, value );        
    }
    
    /**
     * Gets the field of a given object
     */
    private <T> T getFieldValue (Object instance, String fieldName)
        throws NoSuchFieldException, SecurityException, IllegalArgumentException, IllegalAccessException {
        Field field = instance.getClass().getDeclaredField(fieldName);        
        field.setAccessible(true);        
        return (T)field.get(instance);        
    }
}
